---
output: 
  pdf_document:
    toc: no
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
\begin{center}
\vspace*{75pt}
\Huge \textbf{Who are the financial profiteers of war?} \\
\vspace{50pt}
\Large University of Applied Sciences Lucerne \\[10pt]
\Large Master of Science in Applied Information and Data Science \\[10pt]
\Large Time Series in Finance (TSA01) \\[10pt]
\vspace{50pt}
\Large Authors: Mich√®le Gerber and Damien Grossniklaus \\
\Large Date of Submission: 22. December 2023 \\
\end{center}



\newpage
```{=latex}
\setcounter{tocdepth}{4}
\tableofcontents
```
\newpage


```{r, echo=FALSE, results=FALSE, message=FALSE}
library(quantmod)
library(tseries)
library(gtrendsR)
library(lubridate)
library(ggplot2)
library(zoo)
library(dplyr)
library(tidyr)
```


**Potential structure**

- Context and Goal (Literature?)
- Methods
- Data
  - Import data (indices & Google words)
  - Describe data
  - Preprocessing
- VAR & Causality Testing
- Results & Discussion


## 1. Context and Goal

With recent outbreaks of war (e.g., in Israel or in the Ukraine), the question arises of how stock markets react to this and if there are sectors that profit from such crises. Specifically, the case study should examine if certain indices from specific economic sectors perform well in situations of crisis. To do this, the performance of several sector-specific indices in relation to an overall crisis measure should be compared and evaluated with the goal of examining if positive correlations between situations of crisis and stock market profits exist. Alternatively, the research question could be evaluated by comparing the development of sector-specific indices since the outbreak of the war in the Ukraine with the development of non-sector-specific indices (like SMI or S&P 500). If they perform better than overall indices this would indicate that they profit from war.

## 2. Methods

The precise methods to examine the hypothesis are not clear yet and will have to be decided once more methods are introduced in the lectures. However, correlation measurements as well as potential tests for causality will have to be included. If we use the alternative way to answer our research question we could probably use OLS (as described in class last week).

## 3. Data


Import Time Series Data

TODO: 
- Justify why Adjusted values and not close values
- Timeframe: December 2021 until December 2022
```{r}
# Ticker Data
ticker_data <- NULL
tickers_index <- c("XLK", "XLF", "XLV", "XLY", "XLE", "XLU")

for (Ticker in tickers_index){
  ticker_data <- cbind(ticker_data,
                       getSymbols.yahoo(Ticker, from="2021-12-01", to="2023-12-01", 
                                        periodicity = "weekly",auto.assign=FALSE)[,6])
}
# Remove first row as it is still in November to match Gtrends data
ticker_data <- ticker_data[-1, ] 

# Check length and min max date
length(ticker_data$XLK.Adjusted)
summary(ticker_data)[c(1, 6)]
```


```{r}
ticker_data
```

```{r, eval=FALSE}
# Google Trends data
gtrends_war_web <- gtrends(
  keyword = "war",
  time = "2021-11-30 2023-12-01",
  gprop = "web"
)$interest_over_time
gtrends_war_web
```

```{r}
# Too many requests exclude?
#gtrends_war_news <- gtrends(
  #keyword = "war",
  #time = "2021-12-01 2023-12-01",
 # gprop = "news"
#)$interest_over_time
```

Google Trends delivers data always from Sunday weekly. This has to be put to the weekly data from the financial tickers, which always starts at Monday.


```{r, eval=FALSE}
# Increase date by one day to match ticker data
gtrends_war_web$date <- gtrends_war_web$date + days(1)

# Check length and min max date
length(gtrends_war_web$date)
min(gtrends_war_web$date)
max(gtrends_war_web$date)
```



```{r}
# Visualization
ticker_data_df <- fortify.zoo(ticker_data)
colnames(ticker_data_df)[1] <- "Date"
ticker_data_df <- gather(ticker_data_df, key="Ticker", value="Value", 
                         c("XLK.Adjusted", "XLF.Adjusted", "XLV.Adjusted", 
                           "XLY.Adjusted", "XLE.Adjusted", "XLU.Adjusted"), -Date)

ticker_data_df
```

```{r}
ggplot(ticker_data_df, aes(Date, Value)) +
  geom_line(color='darkseagreen3') +
  facet_wrap(~Ticker) +
  labs(title="Ticker Time Series") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```



## 4. VAR & Causality Testing


## 5. Results & Discussion


